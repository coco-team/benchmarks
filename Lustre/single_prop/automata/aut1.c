#include <assert.h>
#include "aut1.h"

/* C code generated by lustrec
   SVN version number 1.0-Unversioned directory
   Code is C99 compliant */
   
/* Import dependencies */

/* Global constants (definitions) */

/* Struct definitions */
struct test1_mem {struct test1_reg {_Bool __test1_12; parity__type __test1_13; } _reg; struct _arrow_mem *ni_2; struct parity__Odd_handler_until_mem *ni_1; struct parity__Even_handler_until_mem *ni_0; };
struct parity__Odd_handler_until_mem {struct parity__Odd_handler_until_reg {
                                      int __parity__Odd_handler_until_2; } _reg; struct _arrow_mem *ni_3; };
struct parity__Even_handler_until_mem {struct parity__Even_handler_until_reg {
                                       int __parity__Even_handler_until_2; } _reg; struct _arrow_mem *ni_4; };


void test1_reset (struct test1_mem *self) {
  
  _arrow_reset(self->ni_2);
  parity__Odd_handler_until_reset(self->ni_1);
  parity__Even_handler_until_reset(self->ni_0);
  return;
}

void test1_step (int x, 
                 _Bool (*y),
                 struct test1_mem *self) {
  _Bool __test1_1;
  int __test1_10;
  _Bool __test1_11;
  parity__type __test1_2;
  _Bool __test1_3;
  parity__type __test1_4;
  _Bool __test1_5;
  parity__type __test1_6;
  int __test1_7;
  _Bool __test1_8;
  parity__type __test1_9;
  int l;
  _Bool parity__next_restart_in;
  parity__type parity__next_state_in;
  _Bool parity__restart_act;
  _Bool parity__restart_in;
  parity__type parity__state_act;
  parity__type parity__state_in;
  
  _arrow_step (1, 0, &__test1_11, self->ni_2);
  if (__test1_11) {
    parity__state_in = Even;
    parity__restart_in = 0;
  } else {
    parity__state_in = self->_reg.__test1_13;
    parity__restart_in = self->_reg.__test1_12;
  }
  switch(parity__state_in) {
    case Even:
      parity__Even_unless_step (parity__restart_in, parity__state_in, x, &__test1_3, &__test1_4);
      parity__state_act = __test1_4;
      parity__restart_act = __test1_3;
      break;
    case Odd:
      parity__Odd_unless_step (parity__restart_in, parity__state_in, x, &__test1_1, &__test1_2);
      parity__state_act = __test1_2;
      parity__restart_act = __test1_1;
      break;
    }
  switch(parity__state_act) {
    case Even:
      if (parity__restart_act) {
        parity__Even_handler_until_reset(self->ni_0);
      } else {
      }
      parity__Even_handler_until_step (parity__restart_act, parity__state_act, x, &__test1_8, &__test1_9, &__test1_10, self->ni_0);
      l = __test1_10;
      break;
    case Odd:
      if (parity__restart_act) {
        parity__Odd_handler_until_reset(self->ni_1);
      } else {
      }
      parity__Odd_handler_until_step (parity__restart_act, parity__state_act, x, &__test1_5, &__test1_6, &__test1_7, self->ni_1);
      l = __test1_7;
      break;
    }
  *y = (l == 1);
  switch(parity__state_act) {
    case Even:
      parity__next_state_in = __test1_9;
      parity__next_restart_in = __test1_8;
      break;
    case Odd:
      parity__next_state_in = __test1_6;
      parity__next_restart_in = __test1_5;
      break;
    }
  self->_reg.__test1_13 = parity__next_state_in;
  self->_reg.__test1_12 = parity__next_restart_in;
  return;
}

void parity__Odd_unless_step (_Bool parity__restart_in,
                              parity__type parity__state_in, int x, 
                              _Bool (*parity__restart_act),
                              parity__type (*parity__state_act)
                              ) {
  _Bool __parity__Odd_unless_1;
  
  __parity__Odd_unless_1 = ((x % 2) == 0);
  if (__parity__Odd_unless_1) {
    *parity__state_act = Even;
    *parity__restart_act = 1;
  } else {
    *parity__state_act = parity__state_in;
    *parity__restart_act = parity__restart_in;
  }
  return;
}

void parity__Odd_handler_until_reset (struct parity__Odd_handler_until_mem *self) {
  
  _arrow_reset(self->ni_3);
  return;
}

void parity__Odd_handler_until_step (_Bool parity__restart_act,
                                     parity__type parity__state_act, int x, 
                                     _Bool (*parity__restart_in),
                                     parity__type (*parity__state_in),
                                     int (*l_out),
                                     struct parity__Odd_handler_until_mem *self) {
  _Bool __parity__Odd_handler_until_1;
  int l;
  
  *parity__state_in = parity__state_act;
  *parity__restart_in = parity__restart_act;
  _arrow_step (1, 0, &__parity__Odd_handler_until_1, self->ni_3);
  if (__parity__Odd_handler_until_1) {
    l = x;
  } else {
    l = self->_reg.__parity__Odd_handler_until_2;
  }
  *l_out = l;
  self->_reg.__parity__Odd_handler_until_2 = ((3 * l) + 1);
  return;
}

void parity__Even_unless_step (_Bool parity__restart_in,
                               parity__type parity__state_in, int x, 
                               _Bool (*parity__restart_act),
                               parity__type (*parity__state_act)
                               ) {
  _Bool __parity__Even_unless_1;
  
  __parity__Even_unless_1 = ((x % 2) == 1);
  if (__parity__Even_unless_1) {
    *parity__state_act = Odd;
    *parity__restart_act = 1;
  } else {
    *parity__state_act = parity__state_in;
    *parity__restart_act = parity__restart_in;
  }
  return;
}

void parity__Even_handler_until_reset (struct parity__Even_handler_until_mem *self) {
  
  _arrow_reset(self->ni_4);
  return;
}

void parity__Even_handler_until_step (_Bool parity__restart_act,
                                      parity__type parity__state_act, int x, 
                                      _Bool (*parity__restart_in),
                                      parity__type (*parity__state_in),
                                      int (*l_out),
                                      struct parity__Even_handler_until_mem *self) {
  _Bool __parity__Even_handler_until_1;
  int l;
  
  *parity__state_in = parity__state_act;
  *parity__restart_in = parity__restart_act;
  _arrow_step (1, 0, &__parity__Even_handler_until_1, self->ni_4);
  if (__parity__Even_handler_until_1) {
    l = x;
  } else {
    l = self->_reg.__parity__Even_handler_until_2;
  }
  *l_out = l;
  self->_reg.__parity__Even_handler_until_2 = (l / 2);
  return;
}

